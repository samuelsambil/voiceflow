<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeVoice - Microsoft TTS Powered</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; animation: fadeInDown 0.8s ease; }
        .logo { font-size: 3rem; margin-bottom: 10px; }
        h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .subtitle { font-size: 1.1rem; opacity: 0.9; }
        .powered-by { margin-top: 10px; font-size: 0.9rem; opacity: 0.8; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .powered-badge { background: rgba(255, 255, 255, 0.2); padding: 5px 15px; border-radius: 20px; backdrop-filter: blur(10px); }
        .stats-bar { display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; animation: fadeIn 1s ease; }
        .stat-item { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 15px; padding: 15px 30px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); }
        .stat-value { font-size: 2rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.9rem; opacity: 0.8; }
        .mode-selector { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; animation: fadeIn 1.2s ease; }
        .mode-btn { background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: #fff; padding: 15px 30px; border-radius: 50px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        .mode-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .mode-btn.active { background: rgba(255, 255, 255, 0.9); color: #667eea; font-weight: bold; border-color: #fff; }
        .personality-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .personality-btn { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff; padding: 10px 20px; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; }
        .personality-btn.active { background: rgba(255, 255, 255, 0.3); font-weight: bold; }
        .voice-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .voice-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 8px 15px; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; font-size: 0.85rem; }
        .voice-btn.active { background: rgba(255, 255, 255, 0.25); font-weight: bold; }
        .chat-container { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-radius: 25px; padding: 30px; margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.2); animation: fadeInUp 0.8s ease; }
        .chat-messages { min-height: 300px; max-height: 500px; overflow-y: auto; margin-bottom: 20px; padding: 20px; background: rgba(0, 0, 0, 0.1); border-radius: 15px; }
        .message { margin-bottom: 15px; padding: 15px; border-radius: 15px; animation: slideIn 0.3s ease; }
        .message.user { background: rgba(255, 255, 255, 0.2); margin-left: 20%; text-align: right; }
        .message.ai { background: rgba(255, 255, 255, 0.15); margin-right: 20%; }
        .message.ai.speaking { border: 2px solid rgba(255, 215, 0, 0.5); box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .input-area { display: flex; gap: 10px; }
        .input-box { flex: 1; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50px; padding: 15px 25px; color: #fff; font-size: 1rem; outline: none; }
        .input-box::placeholder { color: rgba(255, 255, 255, 0.7); }
        .voice-record-btn { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .voice-record-btn:hover { transform: scale(1.1); }
        .voice-record-btn.recording { animation: pulse 1s infinite; background: linear-gradient(135deg, #ff6b6b 0%, #ff0000 100%); }
        .send-btn { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; color: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .send-btn:hover { transform: scale(1.1); }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .action-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 20px; padding: 25px; cursor: pointer; transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.2); }
        .action-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); background: rgba(255, 255, 255, 0.25); }
        .action-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .action-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        .action-desc { font-size: 0.9rem; opacity: 0.8; }
        .badges-section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-radius: 25px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2); }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .badge { background: rgba(255, 255, 255, 0.15); border-radius: 15px; padding: 20px; text-align: center; transition: all 0.3s ease; }
        .badge.earned { background: rgba(255, 255, 255, 0.3); box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); }
        .badge-icon { font-size: 3rem; margin-bottom: 10px; filter: grayscale(100%); }
        .badge.earned .badge-icon { filter: grayscale(0%); animation: bounce 0.5s ease; }
        .loading { text-align: center; padding: 20px; opacity: 0.7; }
        .spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üéôÔ∏è</div>
            <h1>VibeVoice Assistant</h1>
            <p class="subtitle">AI-powered companion with Microsoft TTS</p>
            <div class="powered-by">
                <span class="powered-badge">ü§ñ Qwen AI</span>
                <span class="powered-badge">üé§ VibeVoice TTS</span>
                <span class="powered-badge">üëÇ Faster-Whisper</span>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item"><span class="stat-value" id="streak-count">0</span><span class="stat-label">üî• Day Streak</span></div>
            <div class="stat-item"><span class="stat-value" id="badge-count">0</span><span class="stat-label">üèÜ Badges</span></div>
            <div class="stat-item"><span class="stat-value" id="interaction-count">0</span><span class="stat-label">üí¨ Chats</span></div>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="chat">üí¨ Chat</button>
            <button class="mode-btn" data-mode="voice">üé§ Voice</button>
            <button class="mode-btn" data-mode="hybrid">üîÄ Hybrid</button>
        </div>

        <div class="personality-selector">
            <button class="personality-btn" data-personality="coach">üèãÔ∏è Coach</button>
            <button class="personality-btn active" data-personality="friend">üíô Friend</button>
            <button class="personality-btn" data-personality="executive">üíº Executive</button>
        </div>

        <div class="voice-selector">
            <span style="margin-right: 10px; opacity: 0.8;">üé§ Voice:</span>
            <button class="voice-btn active" data-voice="Emma">Emma</button>
            <button class="voice-btn" data-voice="James">James</button>
            <button class="voice-btn" data-voice="Sophia">Sophia</button>
            <button class="voice-btn" data-voice="Alex">Alex</button>
        </div>

        <div class="quick-actions">
            <div class="action-card" onclick="quickAction('briefing')">
                <div class="action-icon">üåÖ</div>
                <div class="action-title">Daily Briefing</div>
                <div class="action-desc">Get your personalized morning update</div>
            </div>
            <div class="action-card" onclick="quickAction('organize')">
                <div class="action-icon">üß†</div>
                <div class="action-title">Organize Thoughts</div>
                <div class="action-desc">Brain dump and get clarity</div>
            </div>
            <div class="action-card" onclick="quickAction('focus')">
                <div class="action-icon">üéØ</div>
                <div class="action-title">Focus Session</div>
                <div class="action-desc">Plan your next productive hour</div>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message ai"><strong>VibeVoice:</strong> Hey there! üëã I'm powered by Microsoft's VibeVoice TTS for natural-sounding responses. What's on your mind?</div>
            </div>
            <div class="input-area">
                <button class="voice-record-btn" id="voice-btn" onclick="toggleVoiceRecording()">üé§</button>
                <input type="text" class="input-box" id="message-input" placeholder="Type your message or use voice..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>

        <div class="badges-section">
            <h2>üèÜ Your Achievements</h2>
            <div class="badges-grid" id="badges-grid"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://paula-unmoldable-alma.ngrok-free.dev';
        let currentMode = 'chat';
        let currentPersonality = 'friend';
        let currentVoice = 'Emma';
        let isRecording = false;
        let recognition = null;
        let currentAudio = null;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('message-input').value = transcript;
                sendMessage();
            };
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                isRecording = false;
                document.getElementById('voice-btn').classList.remove('recording');
            };
            recognition.onend = () => {
                isRecording = false;
                document.getElementById('voice-btn').classList.remove('recording');
            };
        }

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.dataset.mode;
            });
        });

        document.querySelectorAll('.personality-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.personality-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPersonality = btn.dataset.personality;
            });
        });

        document.querySelectorAll('.voice-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.voice-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentVoice = btn.dataset.voice;
            });
        });

        function toggleVoiceRecording() {
            if (!recognition) {
                alert('Voice recognition not supported. Please use Chrome or Edge.');
                return;
            }
            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
                isRecording = true;
                document.getElementById('voice-btn').classList.add('recording');
            }
        }

        async function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;

            showMessage('user', message);
            input.value = '';
            const loadingId = showLoading();

            try {
                const response = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        mode: currentMode,
                        personality: currentPersonality,
                        voice_name: currentVoice
                    })
                });

                const data = await response.json();
                removeLoading(loadingId);
                const messageId = showMessage('ai', data.response);

                if (data.audio_base64) {
                    playBase64Audio(data.audio_base64, messageId);
                }
                updateStats(data.streaks, data.new_badges);
            } catch (error) {
                removeLoading(loadingId);
                showMessage('ai', '‚ùå Connection error. Is your backend running?');
                console.error('Error:', error);
            }
        }

        function playBase64Audio(base64Audio, messageId) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            const binaryString = atob(base64Audio);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            const blob = new Blob([bytes], { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(blob);
            currentAudio = new Audio(audioUrl);
            const messageEl = document.getElementById(messageId);
            if (messageEl) {
                messageEl.classList.add('speaking');
                currentAudio.onended = () => {
                    messageEl.classList.remove('speaking');
                    URL.revokeObjectURL(audioUrl);
                };
            }
            currentAudio.play().catch(err => console.error('Audio play error:', err));
        }

        async function quickAction(action) {
            if (action === 'briefing') {
                const loadingId = showLoading();
                try {
                    const response = await fetch(`${API_URL}/daily-briefing`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ personality: currentPersonality })
                    });
                    const data = await response.json();
                    removeLoading(loadingId);
                    showMessage('ai', `üìÖ ${data.briefing}`);
                } catch (error) {
                    removeLoading(loadingId);
                    console.error('Error:', error);
                }
            } else if (action === 'organize') {
                document.getElementById('message-input').value = 'Help me organize my thoughts: ';
                document.getElementById('message-input').focus();
            } else if (action === 'focus') {
                sendPredefinedMessage('Help me plan a focused work session for the next hour.');
            }
        }

        async function sendPredefinedMessage(message) {
            showMessage('user', message);
            const loadingId = showLoading();
            try {
                const response = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        mode: currentMode,
                        personality: currentPersonality,
                        voice_name: currentVoice
                    })
                });
                const data = await response.json();
                removeLoading(loadingId);
                const messageId = showMessage('ai', data.response);
                if (data.audio_base64) {
                    playBase64Audio(data.audio_base64, messageId);
                }
            } catch (error) {
                removeLoading(loadingId);
                console.error('Error:', error);
            }
        }

        function showMessage(type, text) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            const messageId = 'msg-' + Date.now();
            messageDiv.id = messageId;
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<strong>${type === 'user' ? 'You' : 'VibeVoice'}:</strong> ${text}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return messageId;
        }

        function showLoading() {
            const messagesDiv = document.getElementById('chat-messages');
            const loadingDiv = document.createElement('div');
            const id = 'loading-' + Date.now();
            loadingDiv.id = id;
            loadingDiv.className = 'loading';
            loadingDiv.innerHTML = '<div class="spinner"></div>';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return id;
        }

        function removeLoading(id) {
            const loadingDiv = document.getElementById(id);
            if (loadingDiv) loadingDiv.remove();
        }

        function updateStats(streaks, newBadges) {
            document.getElementById('streak-count').textContent = streaks || 0;
            if (newBadges && newBadges.length > 0) {
                showMessage('ai', `üéâ New badge unlocked: ${newBadges[0]}`);
            }
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const data = await response.json();
                document.getElementById('streak-count').textContent = data.streaks || 0;
                document.getElementById('badge-count').textContent = data.badges.length || 0;
                document.getElementById('interaction-count').textContent = data.total_interactions || 0;
                const badgesResponse = await fetch(`${API_URL}/badges`);
                const badgesData = await badgesResponse.json();
                displayBadges(badgesData.badges);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function displayBadges(badges) {
            const badgesGrid = document.getElementById('badges-grid');
            badgesGrid.innerHTML = '';
            badges.forEach(badge => {
                const badgeDiv = document.createElement('div');
                badgeDiv.className = `badge ${badge.earned ? 'earned' : ''}`;
                badgeDiv.innerHTML = `
                    <div class="badge-icon">${badge.name.split(' ')[0]}</div>
                    <div style="font-size: 0.9rem; font-weight: bold;">${badge.name.split(' ').slice(1).join(' ')}</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 5px;">${badge.description}</div>
                `;
                badgesGrid.appendChild(badgeDiv);
            });
        }

        window.addEventListener('load', loadStats);
    </script>
</body>
</html>